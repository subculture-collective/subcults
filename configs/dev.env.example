# ============================================================================
# Subcults Environment Configuration
# ============================================================================
# Copy this file to dev.env and fill in the required values.
# See README.md for detailed configuration documentation.

# ============================================================================
# CORE CONFIGURATION
# ============================================================================

# Environment mode: development, staging, or production
# Affects logging verbosity and feature flags
# Aliases (precedence): SUBCULT_ENV, ENV, GO_ENV
SUBCULT_ENV=development

# API server port
# Default: 8080
# Aliases: SUBCULT_PORT, PORT
SUBCULT_PORT=8080

# ============================================================================
# DATABASE
# ============================================================================

# Neon Postgres connection string with PostGIS extension
# Format: postgres://user:password@host:port/database?sslmode=require
# REQUIRED: Application will not start without this
# Example: postgres://subcults:password@localhost:5432/subcults?sslmode=disable
DATABASE_URL=postgres://subcults:password@localhost:5432/subcults?sslmode=disable

# ============================================================================
# AUTHENTICATION & SECURITY
# ============================================================================

# JWT signing secret for access and refresh tokens
# REQUIRED: Recommended: at least 32 characters for security
# Generate with: openssl rand -base64 32
# Example output: abcdefghijklmnopqrstuvwxyz0123456789ABCD==
JWT_SECRET=

# ============================================================================
# EXTERNAL SERVICES
# ============================================================================

## LiveKit (WebRTC Audio/Video)
# Cloud WebRTC SFU for live audio sessions
# Get credentials from: https://livekit.io/

# LiveKit server WebSocket URL
# REQUIRED: Application will not start without this
# Example: wss://your-project.livekit.cloud
LIVEKIT_URL=

# LiveKit API key for server-side operations
# REQUIRED: Application will not start without this
LIVEKIT_API_KEY=

# LiveKit API secret for token generation
# REQUIRED: Application will not start without this
LIVEKIT_API_SECRET=

## Stripe (Payments)
# Payment processing for tickets, merch, and scene payouts
# Get credentials from: https://dashboard.stripe.com/apikeys

# Stripe secret API key (starts with sk_test_ or sk_live_)
# REQUIRED: Application will not start without this
STRIPE_API_KEY=

# Stripe webhook signing secret for event verification (starts with whsec_)
# REQUIRED: Application will not start without this
# Get from: https://dashboard.stripe.com/webhooks
STRIPE_WEBHOOK_SECRET=

# Stripe Connect onboarding return URL
# REQUIRED: Application will not start without this
# URL to redirect users after successful Stripe Connect onboarding
# Example (dev): http://localhost:3000/stripe/return
# Example (prod): https://subcults.com/stripe/return
STRIPE_ONBOARDING_RETURN_URL=

# Stripe Connect onboarding refresh URL
# REQUIRED: Application will not start without this
# URL to redirect users to continue incomplete Stripe Connect onboarding
# Example (dev): http://localhost:3000/stripe/refresh
# Example (prod): https://subcults.com/stripe/refresh
STRIPE_ONBOARDING_REFRESH_URL=

# Platform fee percentage on Stripe Connect transactions
# Optional: Default is 5.0 (5% platform fee)
# Set to desired percentage (e.g., 7.5 for 7.5%)
STRIPE_APPLICATION_FEE_PERCENT=5.0

## Cloudflare R2 (Media Storage)
# S3-compatible object storage for images, audio, and videos
# Get credentials from: https://dash.cloudflare.com/

# R2 bucket name for media assets
# Example: subcults-media-dev
R2_BUCKET_NAME=

# R2 access key ID for S3 API authentication
R2_ACCESS_KEY_ID=

# R2 secret access key for S3 API authentication
R2_SECRET_ACCESS_KEY=

# R2 endpoint URL for S3 API
# Format: https://<account-id>.r2.cloudflarestorage.com
# Example: https://abc123.r2.cloudflarestorage.com
R2_ENDPOINT=

# R2 public CDN URL for serving optimized images (frontend)
# This is the public URL used by the frontend to fetch images
# Format: https://<custom-domain>.com or https://pub-<hash>.r2.dev
# Example: https://cdn.subcults.com or https://pub-abc123def456.r2.dev
# Note: This is a frontend environment variable (will be prefixed with VITE_)
# Leave empty to use the API proxy at /api/media
VITE_R2_CDN_URL=

# Maximum file upload size in megabytes
# Optional: Default is 15MB
# Example: 15 (default), 50 (larger uploads)
R2_MAX_UPLOAD_SIZE_MB=15

## MapTiler (Map Tiles)
# Map tiles for MapLibre frontend
# Get API key from: https://cloud.maptiler.com/account/keys/

# MapTiler API key for tile requests
# REQUIRED: Application will not start without this
MAPTILER_API_KEY=

## Web Push Notifications (Frontend Only)
# VAPID public key for Web Push notifications
# This is a frontend environment variable (prefixed with VITE_)
# Generate VAPID key pair with: npx web-push generate-vapid-keys
# Only the public key is needed in the frontend
# Keep the private key secure on the backend

# VAPID public key (base64 URL-safe string, starts with 'B')
# Example: BEl62iUYgUivxIkv69yViEuiBIa-Ib37J8xQmr8Db5s...
VITE_VAPID_PUBLIC_KEY=

## Jetstream (AT Protocol)
# Real-time AT Protocol firehose for decentralized data ingestion
# WebSocket endpoint for Jetstream subscription

# Jetstream WebSocket URL
# REQUIRED: Indexer will not start without this
# Default: wss://jetstream1.us-east.bsky.network/subscribe
JETSTREAM_URL=wss://jetstream1.us-east.bsky.network/subscribe

# ============================================================================
# OBSERVABILITY (OPTIONAL)
# ============================================================================

# Prometheus metrics endpoint port
# Default: 9090
# Used by the indexer for exposing Prometheus metrics
METRICS_PORT=9090

# Internal authentication token for metrics endpoint
# Optional: Leave empty to disable authentication on /metrics
# Recommended for production: Use a strong random token
INTERNAL_AUTH_TOKEN=

# Redis connection URL for distributed rate limiting
# Optional: Leave empty to use in-memory rate limiting
# Format: redis://user:password@host:port/db or redis://host:port
# Example: redis://localhost:6379
# Example with auth: redis://:password@redis.example.com:6379/0
# Note: Required for multi-instance deployments to share rate limits
REDIS_URL=

# ============================================================================
# FEATURE FLAGS (OPTIONAL)
# ============================================================================

# Enable trust-weighted ranking in search and feed endpoints
# Default: false
# Set to 'true' to enable trust score weighting in result ranking
# Accepts: true/false, 1/0, yes/no, on/off (case-insensitive)
RANK_TRUST_ENABLED=false

# ============================================================================
# OBSERVABILITY & TRACING (OPTIONAL)
# ============================================================================

# Enable OpenTelemetry distributed tracing
# Default: false
# Accepts: true/false, 1/0, yes/no, on/off (case-insensitive)
TRACING_ENABLED=false

# Tracing exporter type
# Options: otlp-http, otlp-grpc
# Default: otlp-http
TRACING_EXPORTER_TYPE=otlp-http

# OTLP endpoint URL for trace export
# For Jaeger (OTLP): http://localhost:4318 (HTTP) or localhost:4317 (gRPC)
# For production OTLP collectors: https://your-collector:4318
# Leave empty to use default OTLP endpoint
TRACING_OTLP_ENDPOINT=

# Sampling rate for traces (0.0 to 1.0)
# 0.1 = 10% of traces sampled (recommended for production)
# 1.0 = 100% of traces sampled (recommended for development)
# Default: 0.1 (10%)
TRACING_SAMPLE_RATE=1.0

# Disable TLS for OTLP connection (development only)
# Set to true when using local Jaeger without TLS
# Default: false
TRACING_INSECURE=true

# ============================================================================
# CANARY DEPLOYMENT
# ============================================================================

# Enable canary deployment for gradual rollouts
# When enabled, routes a percentage of users to the canary version
# Default: false
CANARY_ENABLED=false

# Percentage of traffic to route to canary (0-100)
# Start with 5%, increase to 25%, then 100% for full rollout
# Default: 5.0
CANARY_TRAFFIC_PERCENT=5.0

# Error rate threshold (%) that triggers auto-rollback
# If canary error rate exceeds this, rollback to stable
# Default: 1.0 (1% error rate)
CANARY_ERROR_THRESHOLD=1.0

# Latency threshold (seconds) that triggers auto-rollback
# P95 latency exceeding this triggers rollback
# Default: 2.0 (2 seconds)
CANARY_LATENCY_THRESHOLD=2.0

# Enable automatic rollback on threshold breach
# Default: true
CANARY_AUTO_ROLLBACK=true

# Monitoring window duration (seconds)
# Metrics are aggregated over this window for rollback decisions
# Default: 300 (5 minutes)
CANARY_MONITORING_WINDOW=300

# Version identifier for canary deployment
# Appears in metrics, logs, and response headers
# Default: "canary"
CANARY_VERSION=canary
